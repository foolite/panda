<?xml version="1.0" encoding="UTF-8"?>
<project name="panda-build-codegen" basedir=".">
	<target name="gen-clean" description="Delete all generated files">
		<delete includeEmptyDirs="true" failonerror="false">
			<fileset dir="${gen.ajax}" includes="**/*"/>
			<fileset dir="${gen.java}" includes="**/*"/>
			<fileset dir="${gen.res}" includes="**/*"/>
			<fileset dir="${gen.tpl}" includes="**/*"/>
			<fileset dir="${gen.ddl}" includes="**/*"/>
		</delete>
	</target>

	<target name="gen-java" description="Automatic generate java source files">
		<delete includeEmptyDirs="true">
			<fileset dir="${gen.java}" includes="**/*"/>
		</delete>
		<taskdef name="genmod" classname="nuts.tools.codegen.MyBatisModelGenerator" classpathref="tools.cp"/>
		<genmod dir="${gen.conf}" includes="*.xml" out="${gen.java}" dbtype="all" verbose="${gen.verbose}"/>
		<taskdef name="genact" classname="nuts.tools.codegen.ActionGenerator" classpathref="tools.cp"/>
		<genact dir="${gen.conf}" includes="*.xml" out="${gen.java}" verbose="${gen.verbose}"/>
	</target>

	<target name="gen-java-gae" description="Automatic generate java source files (GAE)">
		<delete includeEmptyDirs="true">
			<fileset dir="${gen.java}" includes="**/*"/>
		</delete>
		<taskdef name="genmod" classname="nuts.tools.codegen.GaeModelGenerator" classpathref="tools.cp"/>
		<genmod dir="${gen.conf}" includes="*.xml" out="${gen.java}" verbose="${gen.verbose}"/>
		<taskdef name="genact" classname="nuts.tools.codegen.ActionGenerator" classpathref="tools.cp"/>
		<genact dir="${gen.conf}" includes="*.xml" out="${gen.java}" verbose="${gen.verbose}"/>
	</target>

	<target name="gen-ftl" description="Automatic generate freemarker source files">
		<delete includeEmptyDirs="true">
			<fileset dir="${gen.tpl}" includes="**/*"/>
		</delete>

		<taskdef name="genftl" classname="nuts.tools.codegen.FreemarkerGenerator" classpathref="tools.cp"/>
		<genftl dir="${gen.conf}" includes="*.xml" out="${gen.tpl}" verbose="${gen.verbose}"/>
	</target>

	<target name="gen-ftl-gae" description="Automatic generate freemarker source files (GAE)">
		<delete includeEmptyDirs="true">
			<fileset dir="${gen.tpl}" includes="**/*"/>
		</delete>

		<taskdef name="genftl" classname="nuts.tools.codegen.FreemarkerGenerator" classpathref="tools.cp"/>
		<replaceregexp file="${gen.conf}/codegen.properties" 
			match="pdf\.action=/pdf\?url"
			replace="pdf\.action="
			byline="true"
			encoding="ISO-8859-1"/>
		<genftl dir="${gen.conf}" includes="*.xml" out="${gen.tpl}" verbose="${gen.verbose}"/>
		<replaceregexp file="${gen.conf}/codegen.properties" 
			match="pdf\.action="
			replace="pdf\.action=/pdf\?url"
			byline="true"
			encoding="ISO-8859-1"/>
	</target>

	<target name="gen-res" description="Automatic generate resource bundle source files">
		<delete includeEmptyDirs="true">
			<fileset dir="${gen.res}" includes="**/*"/>
		</delete>

		<taskdef name="genpro" classname="nuts.tools.codegen.PropertyGenerator" classpathref="tools.cp"/>
		<genpro dir="${gen.conf}" includes="*.xml" out="${gen.res}" verbose="${gen.verbose}"/>
	</target>

	<target name="gen-ddl" description="Automatic generate ddl sql files">
		<delete includeEmptyDirs="true">
			<fileset dir="${gen.ddl}" includes="**/*"/>
		</delete>

		<taskdef name="genddl" classname="nuts.tools.codegen.DDLGenerator" classpathref="tools.cp"/>
		<genddl dir="${gen.conf}" includes="*.xml" out="${gen.ddl}" dbtype="all" locale="${gen.lang}" verbose="${gen.verbose}"/>
	</target>

	<target name="gen-ajax" description="Automatic generate ajax source files">
		<delete includeEmptyDirs="true">
			<fileset dir="${gen.ajax}" includes="**/*"/>
		</delete>

		<taskdef name="genajax" classname="nuts.tools.codegen.AjaxGenerator" classpathref="tools.cp"/>
		<genajax dir="${gen.conf}" includes="*.xml" out="${gen.ajax}/js" verbose="${gen.verbose}"/>

		<taskdef name="genajaxres" classname="nuts.tools.codegen.AjaxResourceGenerator" classpathref="tools.cp"/>
		<genajaxres dir="${gen.conf}" includes="*.xml" out="${gen.ajax}/res" verbose="${gen.verbose}"/>
	</target>

</project>
